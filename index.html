<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ToDo List</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (CDN) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      referrerpolicy="no-referrer"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            boxShadow: {
              soft: "0 10px 30px rgba(2, 6, 23, 0.10)",
            },
          },
        },
      };
    </script>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <!-- Background -->
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      <div class="absolute -top-24 left-1/2 h-72 w-[42rem] -translate-x-1/2 rounded-full bg-indigo-500/15 blur-3xl"></div>
      <div class="absolute -bottom-24 right-1/3 h-72 w-[42rem] rounded-full bg-fuchsia-500/10 blur-3xl"></div>
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_0%,rgba(99,102,241,.18),transparent_55%),radial-gradient(circle_at_0%_60%,rgba(236,72,153,.10),transparent_50%)]"></div>
    </div>

    <main class="relative mx-auto max-w-3xl px-4 py-10 sm:py-14">
      <!-- Header -->
      <header class="mb-6 sm:mb-8">
        <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
          <div>
            <p class="text-sm text-slate-300">ToDoList · Tailwind CSS · UI only</p>
            <h1 class="mt-1 text-3xl font-semibold tracking-tight sm:text-4xl">오늘 할 일</h1>
            <p class="mt-2 text-sm text-slate-300">
            </p>
          </div>

          <div class="rounded-2xl border border-white/10 bg-white/5 px-4 py-3 backdrop-blur">
            <div class="flex items-center justify-between gap-6 text-sm">
              <span class="text-slate-300">진행률</span>
              <span class="font-medium text-slate-100" id="progressText">2 / 6 완료</span>
            </div>
            <div class="mt-2 h-2 w-56 rounded-full bg-white/10">
              <div class="h-2 w-1/3 rounded-full bg-indigo-400" id="progressBar"></div>
            </div>
          </div>
        </div>
      </header>

      <!-- Card -->
      <section class="rounded-3xl border border-white/10 bg-white/5 p-4 shadow-soft backdrop-blur sm:p-6">
        <!-- Input row (UI only) -->
        <div class="grid gap-3 sm:grid-cols-[1fr_auto]">
          <label class="group relative block">
            <span class="sr-only">할 일 입력</span>
            <div class="pointer-events-none absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14" stroke-linecap="round" />
              </svg>
            </div>
            <input
              type="text"
              placeholder="예) 영어 단어 30개 외우기"
              id="todoInput"
              class="w-full rounded-2xl border border-white/10 bg-slate-950/40 py-3.5 pl-12 pr-4 text-slate-100 placeholder:text-slate-400 outline-none transition focus:border-indigo-400/60 focus:ring-4 focus:ring-indigo-500/15"
            />
          </label>

          <button
            type="button"
            id="addTodoBtn"
            class="inline-flex items-center justify-center gap-2 rounded-2xl bg-indigo-500 px-5 py-3.5 font-medium text-white shadow-lg shadow-indigo-500/25 transition hover:bg-indigo-400 focus:outline-none focus:ring-4 focus:ring-indigo-500/25"
            aria-label="추가"
          >
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 5v14M5 12h14" stroke-linecap="round" />
            </svg>
            추가
          </button>
        </div>

        <!-- Toolbar -->
        <div class="mt-4 flex flex-col gap-3 sm:mt-5 sm:flex-row sm:items-center sm:justify-between">
          <div class="flex flex-wrap items-center gap-2">
            <span class="text-sm text-slate-300">필터</span>
            <div class="flex flex-wrap gap-2">
              <button
                type="button"
                class="rounded-full bg-white/10 px-3 py-1.5 text-sm font-medium text-slate-100 ring-1 ring-white/10"
                data-filter="all"
              >
                전체
              </button>
              <button
                type="button"
                class="rounded-full bg-slate-950/30 px-3 py-1.5 text-sm text-slate-300 ring-1 ring-white/10 hover:bg-white/5"
                data-filter="active"
              >
                진행중
              </button>
              <button
                type="button"
                class="rounded-full bg-slate-950/30 px-3 py-1.5 text-sm text-slate-300 ring-1 ring-white/10 hover:bg-white/5"
                data-filter="completed"
              >
                완료
              </button>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <label class="relative block">
              <span class="sr-only">검색</span>
              <div class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke-linecap="round" />
                </svg>
              </div>
              <input
                type="search"
                placeholder="검색"
                id="searchInput"
                class="w-full rounded-2xl border border-white/10 bg-slate-950/40 py-2.5 pl-10 pr-3 text-sm text-slate-100 placeholder:text-slate-400 outline-none transition focus:border-indigo-400/60 focus:ring-4 focus:ring-indigo-500/15"
              />
            </label>
            <button
              type="button"
              id="sortBtn"
              class="rounded-2xl border border-white/10 bg-slate-950/30 px-3 py-2.5 text-sm text-slate-300 hover:bg-white/5"
              aria-label="정렬"
            >
              최신순
            </button>
          </div>
        </div>

        <!-- List -->
        <div class="mt-5">
          <div class="flex items-center justify-between">
            <h2 class="text-sm font-medium text-slate-200">목록</h2>
            <p class="text-sm text-slate-400" id="countText">총 6개 · 진행중 4 · 완료 2</p>
          </div>

          <ul class="mt-3 space-y-2" id="todoList">
            <!-- Item: active -->
            <li class="group rounded-2xl border border-white/10 bg-slate-950/30 p-4 transition hover:bg-white/5">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>

                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-100" data-field="title">운동 30분 (러닝/스트레칭)</p>
                    <div class="flex items-center gap-2">
                      <span class="rounded-full bg-emerald-500/10 px-2.5 py-1 text-xs font-medium text-emerald-200 ring-1 ring-emerald-500/20" data-field="tag">
                        건강
                      </span>
                      <span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-300 ring-1 ring-white/10" data-field="due">
                        오늘
                      </span>
                    </div>
                  </div>
                  <p class="mt-1 text-sm text-slate-300" data-field="note">
                    물 충분히 마시기 · 러닝 후 가벼운 스트레칭
                  </p>
                  <div class="mt-3 flex flex-wrap items-center gap-2 text-xs text-slate-400">
                    <span class="inline-flex items-center gap-1 rounded-full bg-white/5 px-2.5 py-1 ring-1 ring-white/10" data-field="priority">
                      <span class="h-1.5 w-1.5 rounded-full bg-indigo-400"></span>
                      우선순위: 높음
                    </span>
                    <span class="inline-flex items-center gap-1 rounded-full bg-white/5 px-2.5 py-1 ring-1 ring-white/10" data-field="deadline">
                      마감: 18:00
                    </span>
                  </div>
                </div>

                <div class="flex items-center gap-2">
                  <button
                    type="button"
                    data-action="delete"
                    class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 opacity-100 transition hover:bg-rose-500/10 hover:text-rose-200"
                    aria-label="삭제"
                    title="삭제"
                  >
                    <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                  </button>
                  <button
                    type="button"
                    data-action="edit"
                    class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                    aria-label="수정"
                    title="수정"
                  >
                    <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </li>

            <!-- Item: active -->
            <li class="group rounded-2xl border border-white/10 bg-slate-950/30 p-4 transition hover:bg-white/5">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>

                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-100" data-field="title">프로젝트 기획서 1차 작성</p>
                    <div class="flex items-center gap-2">
                      <span class="rounded-full bg-sky-500/10 px-2.5 py-1 text-xs font-medium text-sky-200 ring-1 ring-sky-500/20" data-field="tag">
                        업무
                      </span>
                      <span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-300 ring-1 ring-white/10" data-field="due">
                        이번 주
                      </span>
                    </div>
                  </div>
                  <p class="mt-1 text-sm text-slate-300" data-field="note">
                    범위/일정/리스크 정리 후 공유
                  </p>
                </div>

                <button
                  type="button"
                  data-action="delete"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-rose-500/10 hover:text-rose-200"
                  aria-label="삭제"
                >
                  <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                </button>
                <button
                  type="button"
                  data-action="edit"
                  class="ml-2 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                  aria-label="수정"
                >
                  <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                </button>
              </div>
            </li>

            <!-- Item: completed -->
            <li class="rounded-2xl border border-white/10 bg-slate-950/20 p-4">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    checked
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>

                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-300 line-through" data-field="title">장보기 (우유, 계란, 채소)</p>
                    <div class="flex items-center gap-2">
                      <span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-400 ring-1 ring-white/10" data-field="tag">
                        완료
                      </span>
                    </div>
                  </div>
                  <p class="mt-1 text-sm text-slate-400 line-through" data-field="note">
                    저녁 준비 전에 완료
                  </p>
                </div>

                <button
                  type="button"
                  data-action="delete"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-400 transition hover:bg-rose-500/10 hover:text-rose-200"
                  aria-label="삭제"
                >
                  <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                </button>
                <button
                  type="button"
                  data-action="edit"
                  class="ml-2 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-400 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                  aria-label="수정"
                >
                  <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                </button>
              </div>
            </li>

            <!-- Item: completed -->
            <li class="rounded-2xl border border-white/10 bg-slate-950/20 p-4">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    checked
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>

                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-300 line-through" data-field="title">메일 확인 및 회신</p>
                    <div class="flex items-center gap-2">
                      <span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-400 ring-1 ring-white/10" data-field="tag">
                        완료
                      </span>
                    </div>
                  </div>
                  <p class="mt-1 text-sm text-slate-400 line-through" data-field="note">
                    미팅 일정 조율 완료
                  </p>
                </div>

                <button
                  type="button"
                  data-action="delete"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-400 transition hover:bg-rose-500/10 hover:text-rose-200"
                  aria-label="삭제"
                >
                  <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                </button>
                <button
                  type="button"
                  data-action="edit"
                  class="ml-2 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-400 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                  aria-label="수정"
                >
                  <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                </button>
              </div>
            </li>

            <!-- Item: active -->
            <li class="group rounded-2xl border border-white/10 bg-slate-950/30 p-4 transition hover:bg-white/5">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>
                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-100" data-field="title">책 20페이지 읽기</p>
                    <span class="rounded-full bg-amber-500/10 px-2.5 py-1 text-xs font-medium text-amber-200 ring-1 ring-amber-500/20" data-field="tag">
                      자기계발
                    </span>
                  </div>
                  <p class="mt-1 text-sm text-slate-300" data-field="note">
                    요약 3줄 남기기
                  </p>
                </div>
                <button
                  type="button"
                  data-action="delete"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-rose-500/10 hover:text-rose-200"
                  aria-label="삭제"
                >
                  <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                </button>
                <button
                  type="button"
                  data-action="edit"
                  class="ml-2 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                  aria-label="수정"
                >
                  <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                </button>
              </div>
            </li>

            <!-- Item: active -->
            <li class="group rounded-2xl border border-white/10 bg-slate-950/30 p-4 transition hover:bg-white/5">
              <div class="flex items-start gap-3">
                <div class="pt-0.5">
                  <input
                    type="checkbox"
                    data-action="toggle"
                    class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                    aria-label="완료 체크"
                  />
                </div>
                <div class="min-w-0 flex-1">
                  <div class="flex flex-wrap items-center justify-between gap-2">
                    <p class="truncate font-medium text-slate-100" data-field="title">방 정리 (책상/서랍)</p>
                    <span class="rounded-full bg-fuchsia-500/10 px-2.5 py-1 text-xs font-medium text-fuchsia-200 ring-1 ring-fuchsia-500/20" data-field="tag">
                      집
                    </span>
                  </div>
                  <p class="mt-1 text-sm text-slate-300" data-field="note">
                    버릴 것 / 보관할 것 분리
                  </p>
                </div>
                <button
                  type="button"
                  data-action="delete"
                  class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-rose-500/10 hover:text-rose-200"
                  aria-label="삭제"
                >
                  <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                </button>
                <button
                  type="button"
                  data-action="edit"
                  class="ml-2 inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 text-slate-300 transition hover:bg-indigo-500/10 hover:text-indigo-200"
                  aria-label="수정"
                >
                  <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                </button>
              </div>
            </li>
          </ul>
        </div>

        <!-- Footer actions (UI only) -->
        <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <p class="text-sm text-slate-400">
            팁: 완료 항목은 흐리게 + 취소선으로 표시했어요.
          </p>
          <div class="flex flex-wrap gap-2">
            <button
              type="button"
              id="clearCompletedBtn"
              class="rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5"
              aria-label="완료 항목 삭제"
            >
              완료 항목 지우기
            </button>
            <button
              type="button"
              id="clearAllBtn"
              class="rounded-2xl border border-white/10 bg-slate-950/30 px-4 py-2.5 text-sm text-slate-300 hover:bg-white/5"
              aria-label="전체 삭제"
            >
              전체 지우기
            </button>
          </div>
        </div>
      </section>

      <footer class="mt-6 text-center text-xs text-slate-500">
        <p>© Tailwind CDN · 단일 페이지 Todo</p>
      </footer>
    </main>
    <script>
      const state = {
        filter: "all",
        search: "",
        sort: "desc",
        editingId: null,
        items: [],
      };

      const STORAGE_KEY = "todo-ui-data";

      const $ = (selector, root = document) => root.querySelector(selector);
      const $$ = (selector, root = document) => Array.from(root.querySelectorAll(selector));

      const els = {
        todoList: $("#todoList"),
        todoInput: $("#todoInput"),
        addTodoBtn: $("#addTodoBtn"),
        progressText: $("#progressText"),
        progressBar: $("#progressBar"),
        countText: $("#countText"),
        searchInput: $("#searchInput"),
        sortBtn: $("#sortBtn"),
        clearCompletedBtn: $("#clearCompletedBtn"),
        clearAllBtn: $("#clearAllBtn"),
      };

      const readSeedItems = () =>
        $$("#todoList > li").map((item) => {
          const checkbox = $('[data-action="toggle"]', item);
          const titleEl = $('[data-field="title"]', item);
          const noteEl = $('[data-field="note"]', item);
          const tagEl = $('[data-field="tag"]', item);
          const dueEl = $('[data-field="due"]', item);
          const priorityEl = $('[data-field="priority"]', item);
          const deadlineEl = $('[data-field="deadline"]', item);

          return {
            id: crypto.randomUUID(),
            title: titleEl ? titleEl.textContent.trim() : "할 일",
            note: noteEl ? noteEl.textContent.trim() : "",
            tag: tagEl ? tagEl.textContent.trim() : "",
            due: dueEl ? dueEl.textContent.trim() : "",
            priority: priorityEl ? priorityEl.textContent.trim() : "",
            deadline: deadlineEl ? deadlineEl.textContent.trim() : "",
            completed: Boolean(checkbox && checkbox.checked),
            createdAt: Date.now(),
          };
        });

      const saveState = () => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state.items));
      };

      const loadState = () => {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (!stored) {
          state.items = readSeedItems();
          saveState();
          return;
        }
        try {
          state.items = JSON.parse(stored);
        } catch (error) {
          state.items = readSeedItems();
          saveState();
        }
      };

      const buildItemMeta = (item) => {
        const badges = [];
        if (item.tag) {
          badges.push(
            `<span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-300 ring-1 ring-white/10">${item.tag}</span>`
          );
        }
        if (item.due) {
          badges.push(
            `<span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-300 ring-1 ring-white/10">${item.due}</span>`
          );
        }
        if (!badges.length && item.completed) {
          badges.push(
            `<span class="rounded-full bg-white/5 px-2.5 py-1 text-xs text-slate-400 ring-1 ring-white/10">완료</span>`
          );
        }
        return badges.join("");
      };

      const buildItemFooter = (item) => {
        const chunks = [];
        if (item.priority) {
          chunks.push(
            `<span class="inline-flex items-center gap-1 rounded-full bg-white/5 px-2.5 py-1 ring-1 ring-white/10">${item.priority}</span>`
          );
        }
        if (item.deadline) {
          chunks.push(
            `<span class="inline-flex items-center gap-1 rounded-full bg-white/5 px-2.5 py-1 ring-1 ring-white/10">${item.deadline}</span>`
          );
        }
        if (!chunks.length) return "";
        return `<div class="mt-3 flex flex-wrap items-center gap-2 text-xs text-slate-400">${chunks.join(
          ""
        )}</div>`;
      };

      const renderList = () => {
        const filtered = state.items.filter((item) => {
          if (state.filter === "active" && item.completed) return false;
          if (state.filter === "completed" && !item.completed) return false;
          if (!state.search) return true;
          const q = state.search.toLowerCase();
          return (
            item.title.toLowerCase().includes(q) ||
            item.note.toLowerCase().includes(q) ||
            item.tag.toLowerCase().includes(q)
          );
        });

        const sorted = [...filtered].sort((a, b) =>
          state.sort === "desc" ? b.createdAt - a.createdAt : a.createdAt - b.createdAt
        );

        els.todoList.innerHTML = sorted
          .map((item) => {
            const isCompleted = item.completed;
            const wrapperClass = isCompleted
              ? "rounded-2xl border border-white/10 bg-slate-950/20 p-4"
              : "group rounded-2xl border border-white/10 bg-slate-950/30 p-4 transition hover:bg-white/5";
            const titleClass = isCompleted
              ? "truncate font-medium text-slate-300 line-through"
              : "truncate font-medium text-slate-100";
            const noteClass = isCompleted
              ? "mt-1 text-sm text-slate-400 line-through"
              : "mt-1 text-sm text-slate-300";
            const iconColor = isCompleted ? "text-slate-400" : "text-slate-300";

            return `
              <li class="${wrapperClass}" data-id="${item.id}">
                <div class="flex items-start gap-3">
                  <div class="pt-0.5">
                    <input
                      type="checkbox"
                      ${isCompleted ? "checked" : ""}
                      data-action="toggle"
                      class="h-5 w-5 rounded-md border-white/20 bg-slate-950/30 text-indigo-400 focus:ring-indigo-500/30"
                      aria-label="완료 체크"
                    />
                  </div>
                  <div class="min-w-0 flex-1">
                    <div class="flex flex-wrap items-center justify-between gap-2">
                      <p class="${titleClass}" data-field="title">${item.title}</p>
                      <div class="flex items-center gap-2" data-field="badges">${buildItemMeta(item)}</div>
                    </div>
                    ${
                      item.note
                        ? `<p class="${noteClass}" data-field="note">${item.note}</p>`
                        : ""
                    }
                    ${buildItemFooter(item)}
                  </div>
                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      data-action="delete"
                      class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 ${iconColor} transition hover:bg-rose-500/10 hover:text-rose-200"
                      aria-label="삭제"
                      title="삭제"
                    >
                      <i class="fa-solid fa-trash-can text-base" aria-hidden="true"></i>
                    </button>
                    <button
                      type="button"
                      data-action="edit"
                      class="inline-flex h-10 w-10 items-center justify-center rounded-xl border border-white/10 bg-slate-950/30 ${iconColor} transition hover:bg-indigo-500/10 hover:text-indigo-200"
                      aria-label="수정"
                      title="수정"
                    >
                      <i class="fa-solid fa-pen text-base" aria-hidden="true"></i>
                    </button>
                  </div>
                </div>
              </li>
            `;
          })
          .join("");

        if (!sorted.length) {
          els.todoList.innerHTML = `
            <li class="rounded-2xl border border-white/10 bg-slate-950/30 p-6 text-center text-sm text-slate-400">
              표시할 항목이 없어요.
            </li>
          `;
        }

        updateSummary();
      };

      const updateSummary = () => {
        const total = state.items.length;
        const completed = state.items.filter((item) => item.completed).length;
        const active = total - completed;

        els.countText.textContent = `총 ${total}개 · 진행중 ${active} · 완료 ${completed}`;
        els.progressText.textContent = `${completed} / ${total} 완료`;
        const percent = total === 0 ? 0 : Math.round((completed / total) * 100);
        els.progressBar.style.width = `${percent}%`;
      };

      const setFilter = (value) => {
        state.filter = value;
        $$(".mt-4 [data-filter]").forEach((btn) => {
          if (btn.dataset.filter === value) {
            btn.classList.remove("bg-slate-950/30", "text-slate-300");
            btn.classList.add("bg-white/10", "font-medium", "text-slate-100");
          } else {
            btn.classList.add("bg-slate-950/30", "text-slate-300");
            btn.classList.remove("bg-white/10", "font-medium", "text-slate-100");
          }
        });
        renderList();
      };

      const toggleSort = () => {
        state.sort = state.sort === "desc" ? "asc" : "desc";
        els.sortBtn.textContent = state.sort === "desc" ? "최신순" : "오래된순";
        renderList();
      };

      const addTodo = () => {
        const raw = els.todoInput.value.trim();
        if (!raw) return;
        const item = {
          id: crypto.randomUUID(),
          title: raw,
          note: "",
          tag: "",
          due: "",
          priority: "",
          deadline: "",
          completed: false,
          createdAt: Date.now(),
        };
        state.items.push(item);
        els.todoInput.value = "";
        saveState();
        renderList();
      };

      const removeTodo = (id) => {
        state.items = state.items.filter((item) => item.id !== id);
        saveState();
        renderList();
      };

      const toggleTodo = (id) => {
        const target = state.items.find((item) => item.id === id);
        if (!target) return;
        target.completed = !target.completed;
        saveState();
        renderList();
      };

      const editTodo = (id) => {
        const target = state.items.find((item) => item.id === id);
        if (!target) return;
        const nextTitle = prompt("제목을 수정하세요.", target.title);
        if (nextTitle === null) return;
        const trimmed = nextTitle.trim();
        if (!trimmed) return;
        target.title = trimmed;
        saveState();
        renderList();
      };

      const clearCompleted = () => {
        state.items = state.items.filter((item) => !item.completed);
        saveState();
        renderList();
      };

      const clearAll = () => {
        state.items = [];
        saveState();
        renderList();
      };

      const handleListClick = (event) => {
        const button = event.target.closest("[data-action]");
        if (!button) return;
        const itemEl = button.closest("li[data-id]");
        if (!itemEl) return;
        const id = itemEl.dataset.id;
        const action = button.dataset.action;

        if (action === "delete") removeTodo(id);
        if (action === "toggle") toggleTodo(id);
        if (action === "edit") editTodo(id);
      };

      const init = () => {
        loadState();
        renderList();
        setFilter("all");

        els.addTodoBtn.addEventListener("click", addTodo);
        els.todoInput.addEventListener("keydown", (event) => {
          if (event.key === "Enter") addTodo();
        });
        els.todoList.addEventListener("click", handleListClick);
        els.searchInput.addEventListener("input", (event) => {
          state.search = event.target.value.trim().toLowerCase();
          renderList();
        });
        els.sortBtn.addEventListener("click", toggleSort);
        $$(".mt-4 [data-filter]").forEach((btn) =>
          btn.addEventListener("click", () => setFilter(btn.dataset.filter))
        );
        els.clearCompletedBtn.addEventListener("click", clearCompleted);
        els.clearAllBtn.addEventListener("click", clearAll);
      };

      init();
    </script>
  </body>
</html>

